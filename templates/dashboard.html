{% extends 'base.html' %}
{% load static %}

{% block title %}Dashboard{% endblock %}
{% block page_title %}Dashboard{% endblock %}

{% block content %}
<style>
    /* Additional glassmorphism effects */
    .metric-card {
        background: linear-gradient(135deg, rgba(255,255,255,0.1), rgba(255,255,255,0.05));
        backdrop-filter: blur(10px);
        border: 1px solid rgba(255,255,255,0.18);
        box-shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.37);
        transition: all 0.3s ease;
    }
    
    .metric-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 15px 35px 0 rgba(31, 38, 135, 0.5);
        background: linear-gradient(135deg, rgba(255,255,255,0.15), rgba(255,255,255,0.08));
    }
    
    .chart-container {
        background: rgba(255, 255, 255, 0.03);
        backdrop-filter: blur(20px);
        border: 1px solid rgba(255,255,255,0.1);
        padding: 20px;
        border-radius: 20px;
        box-shadow: inset 0 0 20px rgba(255,255,255,0.05);
    }
</style>

<!-- Animated Metrics Cards -->
<div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 24px; margin-bottom: 40px;">
    <!-- Total Customers -->
    <div class="metric-card glass-card">
        <div style="display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 20px;">
            <div style="width: 50px; height: 50px; background: linear-gradient(135deg, #4a90e2, #6ba3f0); border-radius: 15px; display: flex; align-items: center; justify-content: center; box-shadow: 0 4px 15px rgba(74, 144, 226, 0.4);">
                <svg width="24" height="24" fill="white">
                    <path d="M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"/>
                </svg>
            </div>
            <span style="background: linear-gradient(135deg, #50c878, #3da863); padding: 6px 12px; border-radius: 20px; font-size: 12px; font-weight: 600;">
                +{{ metrics.customers.new }} New
            </span>
        </div>
        <div style="font-size: 36px; font-weight: 700; margin-bottom: 8px; background: linear-gradient(135deg, #fff, #e0e0e0); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text;">
            {{ metrics.customers.total }}
        </div>
        <div style="font-size: 14px; color: rgba(255,255,255,0.7);">Total Customers</div>
        <div style="margin-top: 15px; padding-top: 15px; border-top: 1px solid rgba(255,255,255,0.1);">
            <div style="display: flex; justify-content: space-between; font-size: 13px;">
                <span style="color: rgba(255,255,255,0.6);">Active:</span>
                <span style="font-weight: 600; color: #50c878;">{{ metrics.customers.active }}</span>
            </div>
        </div>
    </div>
    
    <!-- Total Deals -->
    <div class="metric-card glass-card">
        <div style="display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 20px;">
            <div style="width: 50px; height: 50px; background: linear-gradient(135deg, #50c878, #3da863); border-radius: 15px; display: flex; align-items: center; justify-content: center; box-shadow: 0 4px 15px rgba(80, 200, 120, 0.4);">
                <svg width="24" height="24" fill="white">
                    <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"/>
                </svg>
            </div>
            <span style="background: linear-gradient(135deg, #4a90e2, #3a7bc8); padding: 6px 12px; border-radius: 20px; font-size: 12px; font-weight: 600;">
                {{ metrics.deals.won }} Won
            </span>
        </div>
        <div style="font-size: 36px; font-weight: 700; margin-bottom: 8px; background: linear-gradient(135deg, #fff, #e0e0e0); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text;">
            {{ metrics.deals.total }}
        </div>
        <div style="font-size: 14px; color: rgba(255,255,255,0.7);">Active Deals</div>
        <div style="margin-top: 15px; padding-top: 15px; border-top: 1px solid rgba(255,255,255,0.1);">
            <div style="display: flex; justify-content: space-between; font-size: 13px;">
                <span style="color: rgba(255,255,255,0.6);">Pipeline:</span>
                <span style="font-weight: 600; color: #ffd700;">${{ metrics.deals.pipeline_value|floatformat:0 }}</span>
            </div>
        </div>
    </div>
    
    <!-- Total Revenue -->
    <div class="metric-card glass-card">
        <div style="display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 20px;">
            <div style="width: 50px; height: 50px; background: linear-gradient(135deg, #ffd700, #ffed4e); border-radius: 15px; display: flex; align-items: center; justify-content: center; box-shadow: 0 4px 15px rgba(255, 215, 0, 0.4);">
                <svg width="24" height="24" fill="white">
                    <path d="M11.8 10.9c-2.27-.59-3-1.2-3-2.15 0-1.09 1.01-1.85 2.7-1.85 1.78 0 2.44.85 2.5 2.1h2.21c-.07-1.72-1.12-3.3-3.21-3.81V3h-3v2.16c-1.94.42-3.5 1.68-3.5 3.61 0 2.31 1.91 3.46 4.7 4.13 2.5.6 3 1.48 3 2.41 0 .69-.49 1.79-2.7 1.79-2.06 0-2.87-.92-2.98-2.1h-2.2c.12 2.19 1.76 3.42 3.68 3.83V21h3v-2.15c1.95-.37 3.5-1.5 3.5-3.55 0-2.84-2.43-3.81-4.7-4.4z"/>
                </svg>
            </div>
            <span style="background: linear-gradient(135deg, #8a2be2, #9d4edd); padding: 6px 12px; border-radius: 20px; font-size: 12px; font-weight: 600;">
                This Month
            </span>
        </div>
        <div style="font-size: 36px; font-weight: 700; margin-bottom: 8px; background: linear-gradient(135deg, #fff, #e0e0e0); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text;">
            ${{ metrics.revenue|floatformat:0 }}
        </div>
        <div style="font-size: 14px; color: rgba(255,255,255,0.7);">Total Revenue</div>
        <div style="margin-top: 15px; padding-top: 15px; border-top: 1px solid rgba(255,255,255,0.1);">
            <div style="display: flex; justify-content: space-between; font-size: 13px;">
                <span style="color: rgba(255,255,255,0.6);">Target:</span>
                <span style="font-weight: 600;">$100,000</span>
            </div>
        </div>
    </div>
    
    <!-- Employees -->
    <div class="metric-card glass-card">
        <div style="display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 20px;">
            <div style="width: 50px; height: 50px; background: linear-gradient(135deg, #8a2be2, #9d4edd); border-radius: 15px; display: flex; align-items: center; justify-content: center; box-shadow: 0 4px 15px rgba(138, 43, 226, 0.4);">
                <svg width="24" height="24" fill="white">
                    <path d="M16 11c1.66 0 2.99-1.34 2.99-3S17.66 5 16 5c-1.66 0-3 1.34-3 3s1.34 3 3 3zm-8 0c1.66 0 2.99-1.34 2.99-3S9.66 5 8 5C6.34 5 5 6.34 5 8s1.34 3 3 3zm0 2c-2.33 0-7 1.17-7 3.5V19h14v-2.5c0-2.33-4.67-3.5-7-3.5zm8 0c-.29 0-.62.02-.97.05 1.16.84 1.97 1.97 1.97 3.45V19h6v-2.5c0-2.33-4.67-3.5-7-3.5z"/>
                </svg>
            </div>
            <span style="background: linear-gradient(135deg, #00bcd4, #26c6da); padding: 6px 12px; border-radius: 20px; font-size: 12px; font-weight: 600;">
                {{ metrics.employees.departments }} Depts
            </span>
        </div>
        <div style="font-size: 36px; font-weight: 700; margin-bottom: 8px; background: linear-gradient(135deg, #fff, #e0e0e0); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text;">
            {{ metrics.employees.total }}
        </div>
        <div style="font-size: 14px; color: rgba(255,255,255,0.7);">Total Employees</div>
        <div style="margin-top: 15px; padding-top: 15px; border-top: 1px solid rgba(255,255,255,0.1);">
            <div style="display: flex; justify-content: space-between; font-size: 13px;">
                <span style="color: rgba(255,255,255,0.6);">Departments:</span>
                <span style="font-weight: 600;">{{ metrics.employees.departments }}</span>
            </div>
        </div>
    </div>
</div>

<!-- Charts Grid -->
<div style="display: grid; grid-template-columns: 1fr 1fr; gap: 24px; margin-bottom: 40px;">
    <!-- Customer Status Chart -->
    <div class="chart-container">
        <h3 style="font-size: 18px; margin-bottom: 20px; color: #fff;">Customer Status Distribution</h3>
        {% if charts.customer_status %}
        <img src="data:image/png;base64,{{ charts.customer_status }}" style="width: 100%; height: auto;">
        {% endif %}
    </div>
    
    <!-- Deal Pipeline Chart -->
    <div class="chart-container">
        <h3 style="font-size: 18px; margin-bottom: 20px; color: #fff;">Deal Pipeline Stages</h3>
        {% if charts.deal_stages %}
        <img src="data:image/png;base64,{{ charts.deal_stages }}" style="width: 100%; height: auto;">
        {% endif %}
    </div>
</div>

<div style="display: grid; grid-template-columns: 2fr 1fr; gap: 24px;">
    <!-- Revenue Timeline -->
    <div class="chart-container">
        <h3 style="font-size: 18px; margin-bottom: 20px; color: #fff;">Revenue Trend</h3>
        {% if charts.revenue_timeline %}
        <img src="data:image/png;base64,{{ charts.revenue_timeline }}" style="width: 100%; height: auto;">
        {% endif %}
    </div>
    
    <!-- Department Distribution -->
    <div class="chart-container">
        <h3 style="font-size: 18px; margin-bottom: 20px; color: #fff;">Employees by Department</h3>
        {% if charts.department_distribution %}
        <img src="data:image/png;base64,{{ charts.department_distribution }}" style="width: 100%; height: auto;">
        {% endif %}
    </div>
</div>

<!-- Recent Activities -->
<div class="glass-panel" style="margin-top: 40px;">
    <h3 style="font-size: 18px; margin-bottom: 20px;">Recent Activities</h3>
    <div style="display: grid; gap: 12px;">
        {% for activity in activities %}
        <div style="display: flex; align-items: center; gap: 16px; padding: 12px; background: rgba(255,255,255,0.03); border-radius: 10px;">
            <div style="width: 40px; height: 40px; background: linear-gradient(135deg, #4a90e2, #50c878); border-radius: 10px; display: flex; align-items: center; justify-content: center;">
                <svg width="20" height="20" fill="white">
                    <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"/>
                </svg>
            </div>
            <div style="flex: 1;">
                <div style="font-weight: 500;">{{ activity.message }}</div>
                <div style="font-size: 12px; color: rgba(255,255,255,0.5); margin-top: 4px;">{{ activity.time }}</div>
            </div>
        </div>
        {% empty %}
        <p style="text-align: center; color: rgba(255,255,255,0.5);">No recent activities</p>
        {% endfor %}
    </div>
</div>
{% endblock %}