{% extends 'base.html' %}
{% load static %}

{% block title %}Tasks{% endblock %}
{% block page_title %}Task Management{% endblock %}
{% block page_subtitle %}Organize and track your team's tasks{% endblock %}

{% block content %}
<style>
    .task-priority-high {
        background: rgba(255, 107, 107, 0.2);
        border-left: 3px solid #ff6b6b;
    }
    
    .task-priority-medium {
        background: rgba(255, 215, 0, 0.2);
        border-left: 3px solid #ffd700;
    }
    
    .task-priority-low {
        background: rgba(74, 144, 226, 0.2);
        border-left: 3px solid #4a90e2;
    }
    
    .task-overdue {
        border-left-color: #ff3b30 !important;
        background: rgba(255, 59, 48, 0.1);
    }
    
    .task-completed {
        opacity: 0.7;
        text-decoration: line-through;
    }
    
    .priority-badge {
        padding: 4px 8px;
        border-radius: 12px;
        font-size: 11px;
        font-weight: 600;
        text-transform: uppercase;
        letter-spacing: 0.5px;
    }
    
    .priority-high {
        background: rgba(255, 107, 107, 0.2);
        color: #ff6b6b;
        border: 1px solid rgba(255, 107, 107, 0.3);
    }
    
    .priority-medium {
        background: rgba(255, 215, 0, 0.2);
        color: #ffd700;
        border: 1px solid rgba(255, 215, 0, 0.3);
    }
    
    .priority-low {
        background: rgba(74, 144, 226, 0.2);
        color: #4a90e2;
        border: 1px solid rgba(74, 144, 226, 0.3);
    }
    
    .status-badge {
        padding: 4px 8px;
        border-radius: 12px;
        font-size: 11px;
        font-weight: 600;
    }
    
    .status-pending {
        background: rgba(255, 149, 0, 0.2);
        color: #ff9500;
    }
    
    .status-progress {
        background: rgba(74, 144, 226, 0.2);
        color: #4a90e2;
    }
    
    .status-completed {
        background: rgba(80, 200, 120, 0.2);
        color: #50c878;
    }
    /* Modal Overlay Styles */
    .modal-overlay {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: rgba(0, 0, 0, 0.8);
        backdrop-filter: blur(10px);
        -webkit-backdrop-filter: blur(10px);
        z-index: 9999;
        align-items: center;
        justify-content: center;
        animation: fadeIn 0.3s ease;
    }
    
    .modal-overlay.active {
        display: flex;
    }
    
    .modal-content {
        background: linear-gradient(135deg, rgba(26, 29, 41, 0.95), rgba(45, 49, 66, 0.95));
        backdrop-filter: blur(20px);
        -webkit-backdrop-filter: blur(20px);
        border: 1px solid rgba(255, 255, 255, 0.2);
        border-radius: 20px;
        padding: 40px;
        max-width: 600px;
        width: 90%;
        max-height: 90vh;
        overflow-y: auto;
        box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
        animation: slideUp 0.3s ease;
        position: relative;
    }
    
    @keyframes fadeIn {
        from { opacity: 0; }
        to { opacity: 1; }
    }
    
    @keyframes slideUp {
        from {
            transform: translateY(50px);
            opacity: 0;
        }
        to {
            transform: translateY(0);
            opacity: 1;
        }
    }
    
    .modal-close {
        position: absolute;
        top: 20px;
        right: 20px;
        width: 32px;
        height: 32px;
        border-radius: 50%;
        background: rgba(255, 255, 255, 0.1);
        border: none;
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
        transition: all 0.3s ease;
    }
    
    .modal-close:hover {
        background: rgba(255, 59, 48, 0.3);
        transform: rotate(90deg);
    }
</style>

<!-- Task Statistics -->
<div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; margin-bottom: 32px;">
    <div class="glass-card">
        <div style="display: flex; align-items: center; gap: 12px;">
            <div style="width: 40px; height: 40px; background: linear-gradient(135deg, #4a90e2, #6ba3f0); border-radius: 10px; display: flex; align-items: center; justify-content: center;">
                <svg width="20" height="20" fill="white" viewBox="0 0 24 24">
                    <path d="M19 3h-4.18C14.4 1.84 13.3 1 12 1s-2.4.84-2.82 2H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm-7 0c.55 0 1 .45 1 1s-.45 1-1 1-1-.45-1-1 .45-1 1-1z"/>
                </svg>
            </div>
            <div>
                <div style="font-size: 24px; font-weight: 700;">{{ tasks|length }}</div>
                <div style="font-size: 12px; color: rgba(255,255,255,0.6);">Total Tasks</div>
            </div>
        </div>
    </div>
    
    <div class="glass-card">
        <div style="display: flex; align-items: center; gap: 12px;">
            <div style="width: 40px; height: 40px; background: linear-gradient(135deg, #ff6b6b, #ff8a80); border-radius: 10px; display: flex; align-items: center; justify-content: center;">
                <svg width="20" height="20" fill="white" viewBox="0 0 24 24">
                    <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"/>
                </svg>
            </div>
            <div>
                <div style="font-size: 24px; font-weight: 700; color: #ff6b6b;">{{ overdue_count }}</div>
                <div style="font-size: 12px; color: rgba(255,255,255,0.6);">Overdue</div>
            </div>
        </div>
    </div>
</div>

<!-- Add Task Form -->
<div class="glass-panel" style="margin-bottom: 32px;">
    <h2 style="font-size: 20px; font-weight: 600; margin-bottom: 24px; display: flex; align-items: center; gap: 12px;">
        <svg width="24" height="24" fill="currentColor" viewBox="0 0 24 24">
            <path d="M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z"/>
        </svg>
        Add New Task
    </h2>
    
    <form method="post" action="{% url 'add_task' %}" class="needs-validation" novalidate>
        {% csrf_token %}
        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px;">
            <div>
                <label style="display: block; margin-bottom: 8px; font-weight: 500; color: rgba(255,255,255,0.8);">Task Title *</label>
                <input type="text" name="title" placeholder="Enter task title" class="glass-input" required>
                <div class="invalid-feedback">Please provide a task title.</div>
            </div>
            
            <div>
                <label style="display: block; margin-bottom: 8px; font-weight: 500; color: rgba(255,255,255,0.8);">Assign To</label>
                <select name="assigned_to" class="glass-select">
                    <option value="">Select Team Member</option>
                    {% for employee in employees %}
                    <option value="{{ employee.name }}">{{ employee.name }}</option>
                    {% endfor %}
                </select>
            </div>
            
            <div>
                <label style="display: block; margin-bottom: 8px; font-weight: 500; color: rgba(255,255,255,0.8);">Due Date</label>
                <input type="date" name="due_date" class="glass-input">
            </div>
            
            <div>
                <label style="display: block; margin-bottom: 8px; font-weight: 500; color: rgba(255,255,255,0.8);">Priority</label>
                <select name="priority" class="glass-select" required>
                    {% for priority in priorities %}
                    <option value="{{ priority }}">{{ priority }}</option>
                    {% endfor %}
                </select>
            </div>
            
            <div>
                <label style="display: block; margin-bottom: 8px; font-weight: 500; color: rgba(255,255,255,0.8);">Status</label>
                <select name="status" class="glass-select">
                    <option value="Pending">Pending</option>
                    <option value="In Progress">In Progress</option>
                    <option value="Completed">Completed</option>
                </select>
            </div>
        </div>
        
        <div style="margin-top: 20px;">
            <label style="display: block; margin-bottom: 8px; font-weight: 500; color: rgba(255,255,255,0.8);">Description</label>
            <textarea name="description" placeholder="Describe the task in detail..." class="glass-input" rows="4" style="width: 100%; resize: vertical;"></textarea>
        </div>
        
        <div style="margin-top: 24px;">
            <button type="submit" class="glass-btn primary" style="padding: 12px 32px;">
                <svg width="16" height="16" fill="currentColor" viewBox="0 0 24 24" style="margin-right: 8px;">
                    <path d="M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z"/>
                </svg>
                Create Task
            </button>
        </div>
    </form>
</div>

<!-- Tasks Filter -->
<div class="glass-panel" style="margin-bottom: 24px;">
    <div style="display: flex; flex-wrap: wrap; gap: 16px; align-items: center;">
        <div>
            <label style="font-weight: 500; margin-right: 8px;">Filter by Status:</label>
            <select class="glass-select" onchange="filterTasks(this.value)" style="width: 150px;">
                <option value="">All Tasks</option>
                <option value="Pending">Pending</option>
                <option value="In Progress">In Progress</option>
                <option value="Completed">Completed</option>
            </select>
        </div>
        
        <div>
            <label style="font-weight: 500; margin-right: 8px;">Filter by Priority:</label>
            <select class="glass-select" onchange="filterByPriority(this.value)" style="width: 150px;">
                <option value="">All Priorities</option>
                <option value="High">High</option>
                <option value="Medium">Medium</option>
                <option value="Low">Low</option>
            </select>
        </div>
        
        <div style="margin-left: auto;">
            <span style="color: rgba(255,255,255,0.7);">Total: <strong>{{ tasks|length }}</strong> tasks</span>
        </div>
    </div>
</div>

<!-- Task List -->
<div class="glass-panel">
    <h2 style="font-size: 20px; font-weight: 600; margin-bottom: 24px; display: flex; align-items: center; gap: 12px;">
        <svg width="24" height="24" fill="currentColor" viewBox="0 0 24 24">
            <path d="M14,2H6A2,2 0 0,0 4,4V20A2,2 0 0,0 6,22H18A2,2 0 0,0 20,20V8L14,2M18,20H6V4H13V9H18V20Z"/>
        </svg>
        Task List
    </h2>
    
    {% if tasks %}
    <div class="task-grid" style="display: grid; gap: 16px;">
        {% for task in tasks %}
        <div class="task-card glass-card task-priority-{{ task.priority|lower }} {% if task.status == 'Completed' %}task-completed{% endif %}" 
             id="task-{{ task.id }}" 
             data-status="{{ task.status }}" 
             data-priority="{{ task.priority }}"
             style="padding: 20px; transition: all 0.3s ease; cursor: pointer;"
             onclick="toggleTaskDetails('{{ task.id }}')">
            
            <div style="display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 12px;">
                <div style="flex: 1;">
                    <h3 style="font-size: 16px; font-weight: 600; margin-bottom: 8px; color: #fff;">
                        {{ task.title }}
                    </h3>
                    
                    <div style="display: flex; flex-wrap: wrap; gap: 8px; margin-bottom: 12px;">
                        <span class="priority-badge priority-{{ task.priority|lower }}">
                            {{ task.priority }} Priority
                        </span>
                        
                        {% if task.status == 'Pending' %}
                            <span class="status-badge status-pending">{{ task.status }}</span>
                        {% elif task.status == 'In Progress' %}
                            <span class="status-badge status-progress">{{ task.status }}</span>
                        {% elif task.status == 'Completed' %}
                            <span class="status-badge status-completed">{{ task.status }}</span>
                        {% endif %}
                        
                        {% if task.due_date %}
                            <span style="font-size: 11px; color: rgba(255,255,255,0.6); background: rgba(255,255,255,0.1); padding: 4px 8px; border-radius: 8px;">
                                Due: {{ task.due_date }}
                            </span>
                        {% endif %}
                    </div>
                </div>
                
                <div style="display: flex; gap: 8px;">
                    <button class="glass-btn" 
                            style="padding: 6px 12px; font-size: 12px; background: rgba(74, 144, 226, 0.2); border: 1px solid rgba(74, 144, 226, 0.3);"
                            onclick="event.stopPropagation(); editTask('{{ task.id }}')">
                        <svg width="14" height="14" fill="currentColor" viewBox="0 0 24 24">
                            <path d="M3 17.25V21h3.75L17.81 9.94l-3.75-3.75L3 17.25zM20.71 7.04c.39-.39.39-1.02 0-1.41l-2.34-2.34c-.39-.39-1.02-.39-1.41 0l-1.83 1.83 3.75 3.75 1.83-1.83z"/>
                        </svg>
                    </button>
                    
                    {% if task.status != 'Completed' %}
                    <button class="glass-btn" 
                            style="padding: 6px 12px; font-size: 12px; background: rgba(80, 200, 120, 0.2); border: 1px solid rgba(80, 200, 120, 0.3);"
                            onclick="event.stopPropagation(); completeTask('{{ task.id }}')">
                        <svg width="14" height="14" fill="currentColor" viewBox="0 0 24 24">
                            <path d="M9 16.2L4.8 12l-1.4 1.4L9 19 21 7l-1.4-1.4L9 16.2z"/>
                        </svg>
                    </button>
                    {% else %}
                    <span style="color: #50c878; font-size: 12px; font-weight: 600; display: flex; align-items: center; gap: 4px;">
                        <svg width="14" height="14" fill="currentColor" viewBox="0 0 24 24">
                            <path d="M9 16.2L4.8 12l-1.4 1.4L9 19 21 7l-1.4-1.4L9 16.2z"/>
                        </svg>
                        Done
                    </span>
                    {% endif %}
                </div>
            </div>
            
            <div style="margin-bottom: 12px;">
                {% if task.assigned_to %}
                    <div style="display: flex; align-items: center; gap: 8px; margin-bottom: 8px;">
                        <div style="width: 24px; height: 24px; background: linear-gradient(135deg, #4a90e2, #50c878); border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 10px; font-weight: 600;">
                            {{ task.assigned_to|first|upper }}
                        </div>
                        <span style="font-size: 14px; color: rgba(255,255,255,0.8);">{{ task.assigned_to }}</span>
                    </div>
                {% endif %}
                
                {% if task.description %}
                    <div class="task-description" id="desc-{{ task.id }}" style="display: none; margin-top: 12px; padding: 12px; background: rgba(255,255,255,0.05); border-radius: 8px; font-size: 14px; color: rgba(255,255,255,0.8); line-height: 1.5;">
                        {{ task.description }}
                    </div>
                {% endif %}
            </div>
        </div>
        {% endfor %}
    </div>
    {% else %}
    <div style="text-align: center; padding: 60px 20px; color: rgba(255,255,255,0.6);">
        <svg width="64" height="64" fill="currentColor" viewBox="0 0 24 24" style="margin-bottom: 16px; opacity: 0.5;">
            <path d="M19 3h-4.18C14.4 1.84 13.3 1 12 1s-2.4.84-2.82 2H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm-7 0c.55 0 1 .45 1 1s-.45 1-1 1-1-.45-1-1 .45-1 1-1z"/>
        </svg>
        <h3 style="font-size: 18px; margin-bottom: 8px;">No tasks found</h3>
        <p>Create your first task to get started with project management.</p>
    </div>
    {% endif %}
</div>

<!-- Edit Task Modal with Blur Overlay -->
<div id="editTaskModal" class="modal-overlay">
    <div class="modal-content">
        <button class="modal-close" onclick="closeTaskEditModal()">
            <svg width="16" height="16" fill="white" viewBox="0 0 24 24">
                <path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/>
            </svg>
        </button>
        
        <h2 style="margin-bottom: 30px; font-size: 24px; font-weight: 700; background: linear-gradient(135deg, #4a90e2, #50c878); -webkit-background-clip: text; -webkit-text-fill-color: transparent;">
            Edit Task
        </h2>
        
        <form id="editTaskForm">
            <input type="hidden" id="edit-task-id">
            
            <div style="display: grid; gap: 20px;">
                <div>
                    <label style="display: block; margin-bottom: 8px; font-weight: 500; color: rgba(255,255,255,0.8);">Title *</label>
                    <input type="text" id="edit-task-title" placeholder="Title" class="glass-input" required>
                </div>
                
                <div>
                    <label style="display: block; margin-bottom: 8px; font-weight: 500; color: rgba(255,255,255,0.8);">Description</label>
                    <textarea id="edit-task-description" placeholder="Description" class="glass-input" rows="3"></textarea>
                </div>
                
                <div>
                    <label style="display: block; margin-bottom: 8px; font-weight: 500; color: rgba(255,255,255,0.8);">Assigned To</label>
                    <input type="text" id="edit-task-assigned" placeholder="Assigned To" class="glass-input">
                </div>
                
                <div>
                    <label style="display: block; margin-bottom: 8px; font-weight: 500; color: rgba(255,255,255,0.8);">Due Date</label>
                    <input type="date" id="edit-task-due-date" class="glass-input">
                </div>
                
                <div>
                    <label style="display: block; margin-bottom: 8px; font-weight: 500; color: rgba(255,255,255,0.8);">Priority</label>
                    <select id="edit-task-priority" class="glass-select">
                        {% for priority in priorities %}
                        <option value="{{ priority }}">{{ priority }}</option>
                        {% endfor %}
                    </select>
                </div>
                
                <div>
                    <label style="display: block; margin-bottom: 8px; font-weight: 500; color: rgba(255,255,255,0.8);">Status</label>
                    <select id="edit-task-status" class="glass-select">
                        <option value="Pending">Pending</option>
                        <option value="In Progress">In Progress</option>
                        <option value="Completed">Completed</option>
                    </select>
                </div>
            </div>
            
            <div style="display: flex; gap: 16px; margin-top: 30px;">
                <button type="button" onclick="saveTask()" class="glass-btn primary" style="flex: 1;">
                    <svg width="16" height="16" fill="currentColor" viewBox="0 0 24 24" style="margin-right: 8px;">
                        <path d="M17 3H5c-1.11 0-2 .9-2 2v14c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V7l-4-4zm-5 16c-1.66 0-3-1.34-3-3s1.34-3 3-3 3 1.34 3 3-1.34 3-3 3zm3-10H5V5h10v4z"/>
                    </svg>
                    Save Changes
                </button>
                <button type="button" onclick="closeTaskEditModal()" class="glass-btn secondary">
                    Cancel
                </button>
            </div>
        </form>
    </div>
</div>

<script>
function getCookie(name) {
    let cookieValue = null;
    if (document.cookie && document.cookie !== '') {
        const cookies = document.cookie.split(';');
        for (let i = 0; i < cookies.length; i++) {
            const cookie = cookies[i].trim();
            if (cookie.substring(0, name.length + 1) === (name + '=')) {
                cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                break;
            }
        }
    }
    return cookieValue;
}

function editTask(taskId) {
    fetch(`/api/task/${taskId}/edit/`)
        .then(response => response.json())
        .then(task => {
            document.getElementById('edit-task-id').value = taskId;
            document.getElementById('edit-task-title').value = task.title || '';
            document.getElementById('edit-task-description').value = task.description || '';
            document.getElementById('edit-task-assigned').value = task.assigned_to || '';
            document.getElementById('edit-task-due-date').value = task.due_date || '';
            document.getElementById('edit-task-priority').value = task.priority || 'Medium';
            document.getElementById('edit-task-status').value = task.status || 'Pending';
            
            const modal = document.getElementById('editTaskModal');
            modal.classList.add('active');
            document.body.style.overflow = 'hidden';
        })
        .catch(error => {
            console.error('Error:', error);
            alert('Failed to load task data');
        });
}

function closeTaskEditModal() {
    const modal = document.getElementById('editTaskModal');
    modal.classList.remove('active');
    document.body.style.overflow = '';
}

function saveTask() {
    const taskId = document.getElementById('edit-task-id').value;
    const formData = new FormData();
    formData.append('title', document.getElementById('edit-task-title').value);
    formData.append('description', document.getElementById('edit-task-description').value);
    formData.append('assigned_to', document.getElementById('edit-task-assigned').value);
    formData.append('due_date', document.getElementById('edit-task-due-date').value);
    formData.append('priority', document.getElementById('edit-task-priority').value);
    formData.append('status', document.getElementById('edit-task-status').value);
    
    fetch(`/api/task/${taskId}/edit/`, {
        method: 'POST',
        headers: {
            'X-CSRFToken': getCookie('csrftoken')
        },
        body: formData
    })
    .then(response => {
        if (response.ok) {
            showNotification('Task updated successfully!', 'success');
            setTimeout(() => window.location.reload(), 1000);
        } else {
            showNotification('Failed to update task', 'error');
        }
    })
    .catch(error => {
        console.error('Error:', error);
        showNotification('An error occurred', 'error');
    });
}

function completeTask(taskId) {
    fetch(`/api/tasks/${taskId}/update/`, {
        method: 'POST',
        headers: {
            'Content-Type': 'application/x-www-form-urlencoded',
            'X-CSRFToken': getCookie('csrftoken')
        },
        body: new URLSearchParams({status: 'Completed'})
    })
    .then(response => response.json())
    .then(result => {
        if (result.success) {
            const taskCard = document.getElementById(`task-${taskId}`);
            taskCard.classList.add('task-completed');
            taskCard.setAttribute('data-status', 'Completed');
            showNotification('Task completed successfully!', 'success');
            setTimeout(() => window.location.reload(), 1000);
        } else {
            showNotification('Failed to update task', 'error');
        }
    })
    .catch(error => {
        console.error('Error:', error);
        showNotification('An error occurred', 'error');
    });
}

function toggleTaskDetails(taskId) {
    const description = document.getElementById(`desc-${taskId}`);
    if (description) {
        if (description.style.display === 'none') {
            description.style.display = 'block';
        } else {
            description.style.display = 'none';
        }
    }
}

function filterTasks(status) {
    const tasks = document.querySelectorAll('.task-card');
    tasks.forEach(task => {
        if (status === '' || task.getAttribute('data-status') === status) {
            task.style.display = 'block';
        } else {
            task.style.display = 'none';
        }
    });
}

function filterByPriority(priority) {
    const tasks = document.querySelectorAll('.task-card');
    tasks.forEach(task => {
        if (priority === '' || task.getAttribute('data-priority') === priority) {
            task.style.display = 'block';
        } else {
            task.style.display = 'none';
        }
    });
}

function showNotification(message, type) {
    const notification = document.createElement('div');
    notification.className = `glass-alert ${type}`;
    notification.textContent = message;
    notification.style.cssText = `
        position: fixed; 
        top: 20px; 
        right: 20px; 
        z-index: 3000; 
        min-width: 300px; 
        padding: 16px 20px;
        border-radius: 8px;
        animation: slideInRight 0.3s ease;
    `;
    
    document.body.appendChild(notification);
    
    setTimeout(() => {
        notification.style.animation = 'slideOutRight 0.3s ease';
        setTimeout(() => {
            if (document.body.contains(notification)) {
                document.body.removeChild(notification);
            }
        }, 300);
    }, 3000);
}

// Add CSS animations
const style = document.createElement('style');
style.textContent = `
    @keyframes slideInRight {
        from {
            transform: translateX(100%);
            opacity: 0;
        }
        to {
            transform: translateX(0);
            opacity: 1;
        }
    }
    
    @keyframes slideOutRight {
        from {
            transform: translateX(0);
            opacity: 1;
        }
        to {
            transform: translateX(100%);
            opacity: 0;
        }
    }
    
    .task-card:hover {
        transform: translateY(-2px);
        box-shadow: 0 8px 25px rgba(0, 0, 0, 0.3);
    }
    
    .glass-alert.success {
        background: rgba(80, 200, 120, 0.1);
        border-left: 4px solid #50c878;
        color: #50c878;
    }
    
    .glass-alert.error {
        background: rgba(255, 59, 48, 0.1);
        border-left: 4px solid #ff3b30;
        color: #ff3b30;
    }
`;
document.head.appendChild(style);

// Close modal when clicking outside
document.getElementById('editTaskModal').addEventListener('click', function(e) {
    if (e.target === this) {
        closeTaskEditModal();
    }
});

// Form validation
document.addEventListener('DOMContentLoaded', function() {
    const forms = document.querySelectorAll('.needs-validation');
    
    forms.forEach(form => {
        form.addEventListener('submit', function(event) {
            if (!form.checkValidity()) {
                event.preventDefault();
                event.stopPropagation();
            }
            form.classList.add('was-validated');
        });
    });
});
</script>
{% endblock %}